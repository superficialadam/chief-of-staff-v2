#!/usr/bin/env ruby
# bin/ai
require_relative "../config/environment"

require "readline"
require "io/console"

# load console colors from app/lib/ai/console_colors.rb
require_relative "../app/lib/ai/console_colors"

puts "Chief of Staff REPL — Ctrl+C to quit"

orchestrator = Ai::Orchestrator.new

loop do
  begin
    input = Readline.readline("> ", true)
    break if input.nil? || input.strip.empty?

    result = orchestrator.run!(input)

    # Expect result to be a hash like { agent: "llm", text: "..." }
    agent_name = result[:agent].to_s.upcase
    agent_text = result[:text].to_s

    # colorize / box agent name
    label = Ai::ConsoleColors.colored_badge(agent_name)
    puts "#{label} #{agent_text}"

  rescue Interrupt
    puts "\nExiting."
    exit
  rescue => e
    warn "Error: #{e.class} — #{e.message}"
    warn e.backtrace.first(3).join("\n")
  end
end
